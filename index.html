<!doctype html>
<html class="no-js" lang="en">
<head>
    <meta charset="utf-8"/>
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title></title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css"
          integrity="sha384-PsH8R72JQ3SOdhVi3uxftmaW6Vc51MKb0q5P2rRUpPvrszuE4W1povHYgTpBfshb" crossorigin="anonymous">
    <style>
        #map {
            width: 100%;
            height: 100%;
        }

        html, body {
            height: 100%;
        }

        .row {
            border: 1px dotted black;
        }

        html {
            font-family: Arial, Helvetica, sans-serif;
        }

        .hover-card {
            border: 1px dashed black;
            height: 96px;
            width: 312px;
            position: absolute;
            background-color: aliceblue;
        }

        .hover-card-thumbnail {
            height: 96px;
            width: 96px;
            position: absolute;
        }

        .hover-card-content-wrapper {
            position: absolute;
            left: 100px;
            padding: 5px;
        }

    </style>

</head>
<body>

<div class="container-fluid h-100">
    <div class="row h-100 no-gutters">
        <div class="col-9">
            <div id="map">
            </div>
        </div>
        <div class="col-3">
            plan view
        </div>
    </div>
</div>


<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
        integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
        crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.3/umd/popper.min.js"
        integrity="sha384-vFJXuSJphROIrBnz7yo7oB41mKfc8JzQZiCq4NCceLEaO4IHwicKwpJf9c9IpFgh"
        crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/js/bootstrap.min.js"
        integrity="sha384-alpBpkh1PFOepccYVYDB4do5UnbKysX5WZXm3XxPqe5iKTfUKjNkCk9SaVuEZflJ"
        crossorigin="anonymous"></script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC8aYptivVN3ikaxl5H0dK_clsnSO4MLGE"></script>

<script>
    // custom js code
    InfoWindow.prototype = new google.maps.OverlayView();
    const overlays = [];
    const markers = [];

    function initMap() {

        // server side return
        const data = [
            {
                name: "Glasgow",
                lat: 55.8642,
                lng: -4.2518,
                img: "http://localhost:8000/images/scotland-thumbnail.jpg"
            },
            {
                name: "Edinburgh",
                lat: 55.9533,
                lng: -3.1883,
                img: "http://localhost:8000/images/scotland-thumbnail.jpg"
            }
        ];


        const map = new google.maps.Map($('#map')[0], {
            zoom: 10,
            center: new google.maps.LatLng(0, 0),
        });
        // add markers and center map
        let bounds = new google.maps.LatLngBounds();
        for (let i = 0; i < data.length; i++) {
            const d = data[i];
            const latLng = new google.maps.LatLng(d['lat'], d['lng']);

            // prepare popup on mouseover
            overlays.push(new InfoWindow(d['name'], latLng, d['img'], map));

            markers.push(new google.maps.Marker({
                position: latLng,
                map: map,
                title: d['name'],
                id: i
            }));

            markers[i].addListener('mouseover', function (e) {
                overlays[this.id].show();
            });

            markers[i].addListener('mouseout', function () {
                overlays[this.id].hide();
            });

            bounds = bounds.extend(latLng);
        }
        map.fitBounds(bounds);
        map.setCenter(bounds.getCenter());
    }

    function InfoWindow(name, anchor, image, map) {
        this.anchor_ = anchor;
        this.image_ = image;
        this.map_ = map;
        this.name_ = name;

        this.div_ = null;

        this.setMap(map);
    }

    InfoWindow.prototype.onAdd = function () {
        const div = document.createElement('div');
        div.setAttribute('class', 'hover-card');

        // Create the img element and attach it to the div.
        const img = document.createElement('img');
        img.setAttribute('class', 'hover-card-thumbnail');
        img.src = this.image_;
        div.appendChild(img);

        // content div
        const contentWrapperDiv = document.createElement('div');
        contentWrapperDiv.setAttribute('class', 'hover-card-content-wrapper');
        const contentDiv = document.createElement('div');
        contentDiv.setAttribute('class', 'hover-card-content');
        contentDiv.innerText = this.name_;
        contentWrapperDiv.appendChild(contentDiv);

        // todo: star rating div

        div.appendChild(contentWrapperDiv);

        this.div_ = div;

        // Add the element to the "overlayLayer" pane.
        const panes = this.getPanes();
        panes.overlayLayer.appendChild(div);
    };

    InfoWindow.prototype.draw = function () {
        const overlayProjection = this.getProjection();
        const anchor = overlayProjection.fromLatLngToDivPixel(this.anchor_);

        const div = this.div_;
        // todo: auto calculate offset according to screen boundary
        div.style.left = anchor.x + 'px';
        div.style.top = anchor.y + 'px';
        div.style.width = '312px';
        div.style.height = '96px';
        div.style.visibility = 'hidden';
    };

    InfoWindow.prototype.hide = function () {
        if (this.div_) {
            this.div_.style.visibility = 'hidden';
        }
    };

    InfoWindow.prototype.show = function () {
        if (this.div_) {
            this.div_.style.visibility = 'visible';
        }
    };

    google.maps.event.addDomListener(window, 'load', initMap);

</script>
</body>
</html>